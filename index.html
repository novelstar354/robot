<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>あなたは人間ですか？</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f2f2f2;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
            width: 300px;
            margin: 0 auto;
        }
        h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .checkbox-label, .message {
            font-size: 18px;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn:disabled {
            background-color: #ccc;
        }
        #dragArea {
            width: 200px;
            height: 200px;
            border: 2px dashed #333;
            position: relative;
            margin: 20px auto;
        }
        #dragItem {
            width: 50px;
            height: 50px;
            background-color: blue;
            border-radius: 50%;
            position: absolute;
            cursor: move;
        }
        #mainContainer {
            display: none; /* 最初は表示しない */
        }
    </style>
</head>
<body>

    <div class="container" id="startContainer">
        <h2>あなたはロボットですか？</h2>
        <label class="checkbox-label">
            <input type="checkbox" id="robotCheck">私はロボットではありません。
        </label>
        <br>
        <button id="startBtn" class="btn" disabled onclick="startQuiz()">確認</button>
    </div>

    <div class="container" id="mainContainer">
        <h2>人間確認</h2>
        <p class="message" id="message">計算問題：5 + 3 は？</p>
        <input type="text" id="answerInput" placeholder="答えを入力">
        <br>
        <button id="submitBtn" class="btn" onclick="submitAnswer()">確認</button>
        <div id="dragArea" style="display:none;">
            <p>青い丸を円にドラッグしてください</p>
            <div id="dragItem" draggable="true" ondragstart="dragStart(event)"></div>
        </div>
        <div id="finalMessage" style="display:none;"></div>
    </div>

    <script>
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let questionIndex = 0;
        let isBlocked = false;
        const questions = [
            { type: "calculation", question: "5 + 3", answer: "8" },
            { type: "calculation", question: "12 - 4", answer: "8" },
            { type: "calculation", question: "7 + 9", answer: "16" },
            { type: "calculation", question: "15 / 3", answer: "5" },
            { type: "calculation", question: "9 * 2", answer: "18" },
            { type: "drag", correctAnswer: true }
        ];

        // チェックボックスが選択されたらスタートボタンを有効にする
        const checkBox = document.getElementById('robotCheck');
        const startBtn = document.getElementById('startBtn');
        checkBox.addEventListener('change', function() {
            if (checkBox.checked) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        });

        // スタートボタンがクリックされたらメインのクイズ画面を表示
        function startQuiz() {
            if (checkBox.checked) {
                document.getElementById('startContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                loadNextQuestion();
            }
        }

        function submitAnswer() {
            const input = document.getElementById('answerInput').value;
            const message = document.getElementById('message');
            const submitBtn = document.getElementById('submitBtn');
            const dragArea = document.getElementById('dragArea');

            if (isBlocked) {
                alert('現在、ブロックされています。しばらくお待ちください。');
                return;
            }

            // 計算問題の処理
            if (questions[questionIndex].type === "calculation") {
                if (input.trim() === questions[questionIndex].answer) {  // trimで余分な空白を削除
                    correctAnswers++;
                    incorrectAnswers = 0;
                    questionIndex++;  // 次の問題へ進む
                } else {
                    incorrectAnswers++;
                }
            }
            // ドラッグ＆ドロップ問題の処理
            else if (questions[questionIndex].type === "drag") {
                if (questions[questionIndex].correctAnswer) {
                    correctAnswers++;
                    incorrectAnswers = 0;
                    questionIndex++;
                } else {
                    incorrectAnswers++;
                }
            }

            // 2連続正解で合格
            if (correctAnswers >= 2) {
                showMessage("あなたはロボットではありません");
                setTimeout(() => {
                    window.location.href = "https://novelstar354.github.io/starcorperation"; // ここにリダイレクト先を指定
                }, 2000);
                return;
            }

            // 10連続ミスでブロック
            if (incorrectAnswers >= 10) {
                showMessage("あなたはロボットです");
                isBlocked = true;
                setTimeout(() => {
                    isBlocked = false;
                    showMessage("5分後にもう一度お試しください。");
                }, 300000); // 5分間ブロック
                return;
            }

            // 次の問題に移動
            loadNextQuestion();
        }

        function loadNextQuestion() {
            if (questionIndex >= questions.length) {
                questionIndex = 0; // 最初から繰り返し
            }
            const question = questions[questionIndex];
            const message = document.getElementById('message');
            const dragArea = document.getElementById('dragArea');
            const answerInput = document.getElementById('answerInput');
            const submitBtn = document.getElementById('submitBtn');

            if (question.type === "calculation") {
                message.textContent = `計算問題：${question.question}`;
                answerInput.style.display = "inline-block";
                dragArea.style.display = "none";
            } else if (question.type === "drag") {
                message.textContent = "青い丸を円にドラッグしてください";
                answerInput.style.display = "none";
                dragArea.style.display = "block";
            }
        }

        function showMessage(text) {
            const finalMessage = document.getElementById('finalMessage');
            finalMessage.textContent = text;
            finalMessage.style.display = "block";
        }

        // ドラッグ＆ドロップ機能
        function dragStart(event) {
            event.dataTransfer.setData("text", event.target.id);
        }

        function dragOver(event) {
            event.preventDefault();
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            const dragArea = document.getElementById('dragArea');

            if (draggedElement && dragArea.contains(draggedElement)) {
                questions[questionIndex].correctAnswer = true;
            }
        }
    </script>

</body>
</html>
